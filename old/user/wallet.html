<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KALAMSTORE</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="../assets/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="../assets/css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="assets/css/app.css" />
</head>


<body>
  <!-- ash top and body start -->
  <div>

      <div class="productCnt">

          <!-- top section start  -->

          <div class="top-section-prdt top-section-prdt-update">
            <!-- <div class="black"></div> -->
              <div id="user-name-welcome" class="user-name-welcome2">
                  <a class="top-back-btn" id="goBack">
                      <i class="bi bi-chevron-left"></i>
                      <span>back</span>
                  </a>
              </div>
          </div>

          <!-- top section end  -->

          <div class="cart-container other">
              <h2 id="page-title">Wallet/ Refer & Earn</h2>
              <hr>
              <div id="page-data">

                <div class="form-floating mb-3">
                    <input type="text" class="form-control" placeholder="Enter name" id="walletCode" readonly>
                    <label for="name">Refer Code </label>
                  </div>
              </div>

              

              <div class="form-floating mb-3">
                <input type="text" class="form-control" placeholder="Enter name" id="walletbal" readonly>
                <label for="name">Wallet Balance </label>
              </div>

              <button type="button" onclick="sharecode()" class="btn btn-primary">Share Link</button>


              <form class="form-control d-none" id ="setrefercode">
              <div class="input-group mb-3">
                <input id = "refercodegen" name="refercodegen" type="text" class="form-control" placeholder="Generate Refer Code" aria-label="Recipient's username" aria-describedby="button-addon2" readonly>
                <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="generateCode()">Button</button>
              </div>

              <input class="btn btn-primary" type="submit">
            </form>
          </div>

      </div>
          </div>

      </div>
  </div>

 <!-- ash top and body end -->

  <!-- ash bottom navigation start -->
  <nav class="bottomNav">
    <ul>
      <li>
        <a href="notification.html" class="nav-link">
          <div>
            <i class="bi bi-bell-fill icon-disable-color"></i>
          </div>
          <div class="bottom-dot" hidden></div>
        </a>
      </li>
      <li>
        <a href="home.html" class="nav-link">
          <div>
            <i class="bi bi-house-fill icon-disable-color"></i>
          </div>
          <div class="bottom-dot" hidden></div>
        </a>
      </li>
      <li>
        <a href="setting.html" class="nav-link">
          <div>
            <i class="bi bi-person-fill icon-disable-color"></i>
          </div>
          <div class="bottom-dot" hidden></div>
        </a>
      </li>
    </ul>
  </nav>
  <!-- ash bottom navigation end -->

  <script src="../assets/js/jquery-3.6.1.js"></script>
  <script src="../assets/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/js/popper.min.js"></script>
  <script src="../assets/js/owl.carousel.min.js"></script>
  <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
  <script src="../constant.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
    //   otherPage();
    loadwalletdata();

async function loadwalletdata(){

        const k_id = localStorage.getItem("K_id");
        const formdata = new FormData();
        formdata.append("type", "123");
        formdata.append("id", k_id);
        const req = await fetch(appAPI, { method: "POST", body: formdata });
        const res = await req.json();
        data =JSON.parse(res.wallet) ;
        if(data.wallet_code == ''|| res.wallet == 0){
           $("#setrefercode").removeClass("d-none"); 
        }
        
   
      $("#walletCode").val(data.wallet_code);
      $("#walletbal").val(data.walletBalance);
  
}

const generateRandomCode = (length) => {
                const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let code = '';

                for (let i = 0; i < length; i++) {
                    const randomIndex = Math.floor(Math.random() * characters.length);
                    code += characters[randomIndex];
                }

                return code;
            }
            const generateCode = () => {
                randomcode = generateRandomCode(6);
                $("#refercodegen").val(randomcode);
            }



            $("#setrefercode").on("submit",async function(e){
                  e.preventDefault();
                  const k_id = localStorage.getItem("K_id");
                  const formdata = new FormData(this);
                  formdata.append("type", "131");
                  formdata.append("id", k_id);
                  const req = await fetch(appAPI, { method: "POST", body: formdata });
                  const res = await req.json();
                  console.log(res);
                  alert(res.data.msg);
                  location.reload();
            })

            function sharecode(){
             
              getCode = $("#walletCode").val();
              window.plugins.socialsharing.share('Download App from playstore. Use code at signup for exicting offers. CODE -'+getCode, null, null, 'https://play.google.com/store/apps/details?id='+appID);
            }
  </script>
</body>

</html>